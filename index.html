<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>冒険者ダッシュボード - ホーム</title>
    
    <!-- キャッシュ制御 -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    
    <!-- PWA関連メタタグ -->
    <meta name="theme-color" content="#29B6F6">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="CLAFT">
    <link rel="apple-touch-icon" href="icons/icon-192.png">
    <link rel="manifest" href="manifest.json">
    
    <!-- フォントとスタイル -->
    <link href="https://fonts.googleapis.com/css2?family=M+PLUS+Rounded+1c:wght@400;500;700;900&family=Noto+Sans+JP:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="css/navigation.css">
    <link rel="stylesheet" href="css/auth.css">
    
    <!-- Supabase JS -->
    <script src="https://unpkg.com/@supabase/supabase-js@2.39.0/dist/umd/supabase.min.js"></script>
</head>
<body>
    <!-- ハンバーガーメニュー -->
    <div class="hamburger-menu" id="hamburgerMenu">
        <div class="bar"></div>
        <div class="bar"></div>
        <div class="bar"></div>
    </div>

    <!-- サイドバー -->
    <nav class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <div class="sidebar-logo">🎮 CLAFT</div>
        </div>
        <div class="sidebar-nav">
            <ul>
                <li><a href="index.html" class="active"><i class="fas fa-home"></i><span class="nav-label">ホーム</span></a></li>
                <li><a href="quest.html"><i class="fas fa-map"></i><span class="nav-label">クエストマップ</span></a></li>
                <li><a href="yononaka.html"><i class="fas fa-globe"></i><span class="nav-label">Yononaka</span></a></li>
                <li><a href="mirai.html"><i class="fas fa-rocket"></i><span class="nav-label">ミライクラフト</span></a></li>
            </ul>
        </div>
    </nav>

    <!-- オーバーレイ -->
    <div class="sidebar-overlay" id="sidebarOverlay"></div>

    <!-- 認証ボタン用スペース -->
    <div class="nav-buttons"></div>

    <!-- 背景 -->
    <div class="background-wrapper">
        <div class="parallax-layer sky-layer"></div>
        <div class="parallax-layer clouds">
            <div class="cloud cloud1"></div>
            <div class="cloud cloud2"></div>
            <div class="cloud cloud3"></div>
        </div>
        <div class="city-silhouette"></div>
    </div>

    <!-- ヘッダー -->
    <header class="header">
        <div class="header-content">
            <div class="player-info">
                <div class="greeting-section">
                    <h1 id="greeting">こんにちは、<span id="playerName">たろう</span>さん！</h1>
                    <p id="subGreeting">今日も素晴らしい冒険を始めましょう</p>
                </div>
            </div>
            <div class="auth-status">
                <!-- ログイン前 -->
                <button data-auth-action="login" class="auth-btn login-btn" style="display: none;">
                    <i class="fas fa-sign-in-alt"></i> ログイン/登録
                </button>
                
                <!-- ログイン後 -->
                <div class="user-info" id="userInfo" style="display: none;">
                    <div class="user-details">
                        <span class="user-name" id="headerUserName">ユーザー名</span>
                        <div class="user-stats">
                            <span class="stat-item">
                                <i class="fas fa-calendar-check"></i>
                                <span id="loginCount">0</span>回ログイン
                            </span>
                            <span class="stat-item">
                                <i class="fas fa-trophy"></i>
                                <span id="questClearCount">0</span>クエストクリア
                            </span>
                </div>
                </div>
                    <button data-auth-action="logout" class="auth-btn logout-btn">
                        <i class="fas fa-sign-out-alt"></i> ログアウト
                    </button>
                </div>
            </div>
        </div>
        <div class="exp-bar-container">
            <div class="exp-bar" id="expBar" style="width: 65%;"></div> <!-- styleで初期幅指定 -->
        </div>
    </header>

    <!-- メインコンテンツ -->
    <main class="main-content">
        <!-- プロフィールカード（画面の50%） -->
        <div class="profile-card">
            <!-- 基本情報エリア -->
            <div class="profile-header">
                <div class="profile-avatar">
                    <div class="avatar-container">
                        <i class="fas fa-user"></i>
                    </div>
                    <div class="status-indicator"></div>
                </div>
                <h2 class="profile-name" id="profileName">たろう</h2>
                <p class="profile-character" id="profileCharacter">
                    <span id="characterText">冒険大好き！挑戦者タイプ</span>
                </p>
                <div class="profile-catchphrase" id="profileCatchphrase">
                    <span class="profile-catchphrase-text" id="catchphraseText">「新しいことにチャレンジだ！」</span>
                </div>
            </div>

            <!-- 詳細情報エリア -->
            <div class="profile-details">
                <!-- 能力・特性 -->
                <div class="profile-abilities">
                    <div class="ability-card strength">
                        <div class="ability-header">
                            <div class="ability-icon">💪</div>
                            <div class="ability-title">とくい</div>
                        </div>
                        <div class="ability-tags" id="strengthTags">
                            <span class="ability-tag">プログラミング</span>
                            <span class="ability-tag">デザイン</span>
                            <span class="ability-tag">問題解決</span>
                        </div>
                    </div>
                    <div class="ability-card weakness">
                        <div class="ability-header">
                            <div class="ability-icon">😅</div>
                            <div class="ability-title">よわみ</div>
                        </div>
                        <div class="ability-tags" id="weaknessTags">
                            <span class="ability-tag">時間管理</span>
                            <span class="ability-tag">朝起き</span>
                        </div>
                    </div>
                </div>

                <!-- パーソナル情報 -->
                <div class="profile-personal">
                    <div class="personal-item">
                        <div class="personal-label">
                            <span>🏖️</span>
                            <span>すきな時間・場所</span>
                        </div>
                        <div class="personal-value" id="favoriteTime">
                            カフェでコーヒーを飲みながらコーディング
                        </div>
                    </div>
                    <div class="personal-item">
                        <div class="personal-label">
                            <span>⚡</span>
                            <span>エネルギーチャージ方法</span>
                        </div>
                        <div class="personal-value" id="energyCharge">
                            音楽を聴きながら散歩する
                        </div>
                    </div>
                </div>

                <!-- 一緒に冒険したい人 -->
                <div class="adventure-partner">
                    <div class="adventure-partner-content">
                        <div class="adventure-partner-label">
                            <span>🤝</span>
                            <span>一緒に冒険したい人</span>
                        </div>
                        <div class="adventure-partner-value" id="adventurePartner">
                            新しいアイデアをシェアできるクリエイティブな仲間
                        </div>
                    </div>
                </div>

                <!-- ひとこと -->
                <div class="profile-comment">
                    <div class="comment-header">
                        <span>📝</span>
                        <span>ひとこと</span>
                    </div>
                    <div class="comment-text" id="commentText">
                        毎日が新しい冒険！プログラミングを通じて、世界をもっと便利で楽しい場所にしたいです。一緒に素晴らしいものを作りましょう！
                    </div>
                </div>

                <!-- 編集ボタン -->
                <button class="edit-profile-btn" onclick="goToProfileEdit()">
                    <i class="fas fa-pencil-alt"></i> プロフィール編集
                </button>
            </div>
        </div>

        <!-- コンテンツエリア（画面の50%） -->
        <div class="content-area">
            <!-- クラフトストーリーカード -->
            <div class="craft-story-card">
                <div class="card-header">
                    <h3 class="card-title">
                        <i class="fas fa-book-open"></i>
                        クラフトストーリー
                    </h3>
                </div>
                
                <!-- 目標セクション -->
                <div class="goals-section">
                    <div class="goal-card">
                        <div class="goal-content">
                            <div class="goal-icon">
                                <i class="fas fa-flag-checkered"></i> <!-- 短期目標アイコン -->
                            </div>
                            <div class="goal-label">短期目標</div>
                            <div class="goal-text">プログラミング基礎習得</div>
                            <div class="goal-progress">
                                <div class="goal-progress-bar" style="width: 75%;"></div> <!-- 進捗例 -->
                            </div>
                        </div>
                    </div>
                    <div class="goal-card">
                        <div class="goal-content">
                            <div class="goal-icon">
                                <i class="fas fa-mountain"></i> <!-- 長期目標アイコン -->
                            </div>
                            <div class="goal-label">長期目標</div>
                            <div class="goal-text">アプリ開発者になる</div>
                            <div class="goal-progress">
                                <div class="goal-progress-bar" style="width: 30%;"></div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- アクションセクション -->
                <div class="actions-section">
                    <a href="#created" class="action-link">
                        <div class="action-icon">
                            <i class="fas fa-palette"></i>
                        </div>
                        <div class="action-content">
                            <div class="action-title">つくったもの</div>
                            <div class="action-desc">作品ギャラリーを見る</div>
                        </div>
                        <div class="action-arrow">
                            <i class="fas fa-chevron-right"></i>
                        </div>
                    </a>
                    <a href="#talked" class="action-link">
                        <div class="action-icon">
                            <i class="fas fa-comments"></i>
                        </div>
                        <div class="action-content">
                            <div class="action-title">はなしたこと</div>
                            <div class="action-desc">会話の記録を見る</div>
                        </div>
                        <div class="action-arrow">
                            <i class="fas fa-chevron-right"></i>
                        </div>
                    </a>
                </div>
            </div> <!-- .craft-story-card 終了 -->

            <!-- ジブンクラフトカード (新規追加) -->
            <div class="jibun-craft-card" id="jibun-craft-card-anchor"> <!-- id追加 -->
                <div class="card-header">
                    <h3 class="card-title">
                        <i class="fas fa-cogs"></i> <!-- ジブンクラフト アイコン例 -->
                        ジブンクラフト
                    </h3>
                </div>

                <!-- 5つの力メーター -->
                <div class="powers-section">
                    <div class="power-meter">
                        <div class="power-header">
                            <span class="power-name">
                                <span class="power-icon tsunagu"><i class="fas fa-link"></i></span>
                                つなぐ力
                            </span>
                            <span class="power-level">Lv. 4</span>
                        </div>
                        <div class="power-bar-container">
                            <div class="power-bar tsunagu" style="width: 40%;"></div>
                        </div>
                    </div>
                    <div class="power-meter">
                        <div class="power-header">
                            <span class="power-name">
                                <span class="power-icon hiraku"><i class="fas fa-lightbulb"></i></span>
                                ひらく力
                            </span>
                            <span class="power-level">Lv. 6</span>
                        </div>
                        <div class="power-bar-container">
                            <div class="power-bar hiraku" style="width: 60%;"></div>
                        </div>
                    </div>
                    <div class="power-meter">
                        <div class="power-header">
                            <span class="power-name">
                                <span class="power-icon egaku"><i class="fas fa-pencil-ruler"></i></span>
                                えがく力
                            </span>
                            <span class="power-level">Lv. 6</span>
                        </div>
                        <div class="power-bar-container">
                            <div class="power-bar egaku" style="width: 60%;"></div>
                        </div>
                    </div>
                    <div class="power-meter">
                        <div class="power-header">
                            <span class="power-name">
                                <span class="power-icon narikiru"><i class="fas fa-theater-masks"></i></span>
                                なりきる力
                            </span>
                            <span class="power-level">Lv. 4</span>
                        </div>
                        <div class="power-bar-container">
                            <div class="power-bar narikiru" style="width: 40%;"></div>
                        </div>
                    </div>
                    <div class="power-meter">
                        <div class="power-header">
                            <span class="power-name">
                                <span class="power-icon makikomu"><i class="fas fa-users"></i></span>
                                まきこむ力
                            </span>
                            <span class="power-level">Lv. 4</span>
                        </div>
                        <div class="power-bar-container">
                            <div class="power-bar makikomu" style="width: 40%;"></div>
                        </div>
                    </div>
                </div>

                <!-- スキルタブ -->
                <div class="skills-section">
                    <div class="skills-tabs">
                        <div class="skill-tab active"> <!-- 初期アクティブ例 -->
                            <div class="skill-tab-content">
                                <i class="fas fa-yen-sign"></i>
                                <div class="skill-tab-label">お金</div>
                            </div>
                            <span class="skill-tab-level">Lv.5</span>
                        </div>
                        <div class="skill-tab">
                             <div class="skill-tab-content">
                                <i class="fas fa-laptop-code"></i>
                                <div class="skill-tab-label">技術</div>
                            </div>
                            <span class="skill-tab-level">Lv.3</span>
                        </div>
                        <div class="skill-tab">
                            <div class="skill-tab-content">
                                <i class="fas fa-comments"></i>
                                <div class="skill-tab-label">対話力</div>
                            </div>
                             <span class="skill-tab-level">Lv.4</span>
                        </div>
                        <div class="skill-tab locked">
                            <div class="skill-tab-content">
                                <i class="fas fa-lock"></i>
                                <div class="skill-tab-label">？？？</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div> <!-- .jibun-craft-card 終了 -->
        </div> <!-- .content-area 終了 -->
    </main> <!-- .main-content 終了 -->

    <!-- レベルアップモーダル -->
    <div class="levelup-modal" id="levelUpModal">
        <div class="levelup-content">
            <div class="levelup-icon">🎉</div>
            <h3 class="levelup-title">レベルアップ！</h3>
            <p class="levelup-message">新しいスキルと報酬を獲得しました！</p>
            <div class="levelup-rewards">
                <div class="reward-item">
                    <span class="reward-icon"><i class="fas fa-star"></i></span>
                    <span class="reward-text">+100 EXP</span>
                </div>
                <div class="reward-item">
                    <span class="reward-icon"><i class="fas fa-gem"></i></span>
                    <span class="reward-text">新しいバッジ</span>
                </div>
            </div>
            <button class="levelup-close" onclick="closeLevelUpModal()">閉じる</button>
        </div>
    </div>

    <!-- 通知コンテナ -->
    <div class="notification-container" id="notificationContainer">
        <!-- 通知はJavaScriptで動的に追加されます -->
    </div>

    <!-- Service Worker登録をコメントアウト（一時的） -->
    <!--
    <script>
    if ('serviceWorker' in navigator) {
        // 一時的に無効化
    }
    </script>
    -->

    <!-- 必須スクリプトの読み込み -->
    <script src="js/include.js"></script>

    <!-- Supabaseが読み込まれるのを待ってからauth.jsを読み込む -->
    <script>
    // Supabaseが読み込まれているか確認
    function loadAuthWhenReady() {
        if (window.supabase && window.supabase.createClient) {
            const script = document.createElement('script');
            script.src = 'js/auth.js';
            document.body.appendChild(script);
            console.log('Auth.js loaded');
        } else {
            console.log('Waiting for Supabase...');
            setTimeout(loadAuthWhenReady, 100);
        }
    }
    loadAuthWhenReady();
    </script>

    <!-- ページ固有のスクリプト -->
    <script>
    // ページ読み込み時の初期化
    document.addEventListener('DOMContentLoaded', function() {
        // 認証状態に基づく初期化
        if (window.authManager && authManager.getCurrentUser()) {
            // ログイン済みの場合の処理
            document.getElementById('welcomeMessage').textContent = `ようこそ、${authManager.getCurrentUser().email}さん！`;
        } else {
            // 未ログインの場合の処理
            document.getElementById('welcomeMessage').textContent = 'ようこそ、冒険者さん！';
        }
    });
    </script>
</body>
</html>