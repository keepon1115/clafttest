<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ジブンクラフト - 冒険者プロフィール編集</title>
    
    <!-- キャッシュ制御 -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    
    <!-- PWA関連メタタグ -->
    <meta name="theme-color" content="#29B6F6">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="CLAFT">
    <link rel="apple-touch-icon" href="icons/icon-192.png">
    <link rel="manifest" href="manifest.json">
    
    <!-- フォントとスタイル -->
    <link href="https://fonts.googleapis.com/css2?family=M+PLUS+Rounded+1c:wght@400;500;700;900&family=Noto+Sans+JP:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="css/navigation.css">
    <link rel="stylesheet" href="css/auth.css">
    
    <!-- Supabase JS -->
    <script src="https://unpkg.com/@supabase/supabase-js@2.39.0/dist/umd/supabase.min.js"></script>
</head>
<body>
    <!-- ハンバーガーメニュー -->
    <div class="hamburger-menu" id="hamburgerMenu">
        <div class="bar"></div>
        <div class="bar"></div>
        <div class="bar"></div>
    </div>

    <!-- サイドバー -->
    <nav class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <div class="sidebar-logo">🎮 CLAFT</div>
        </div>
        <div class="sidebar-nav">
            <ul>
                <li><a href="index.html"><i class="fas fa-home"></i><span class="nav-label">ホーム</span></a></li>
                <li><a href="quest.html"><i class="fas fa-map"></i><span class="nav-label">クエストマップ</span></a></li>
                <li><a href="yononaka.html"><i class="fas fa-globe"></i><span class="nav-label">Yononaka</span></a></li>
                <li><a href="mirai.html"><i class="fas fa-rocket"></i><span class="nav-label">ミライクラフト</span></a></li>
            </ul>
        </div>
    </nav>

    <!-- オーバーレイ -->
    <div class="sidebar-overlay" id="sidebarOverlay"></div>

    <!-- 認証ボタン用スペース -->
    <div class="nav-buttons"></div>

    <!-- 背景の部屋 -->
    <div class="room-background">
        <div class="window">
            <div class="sun"></div>
            <div class="cloud cloud1"></div>
        </div>
        <div class="floor"></div>
        <div class="bookshelf">
            <div class="book"></div>
            <div class="book"></div>
            <div class="book"></div>
            <div class="book"></div>
            <div class="book"></div>
        </div>
        <div class="plant">
            <div class="pot"></div>
            <div class="leaf"></div>
            <div class="leaf"></div>
            <div class="leaf"></div>
        </div>
    </div>

    <!-- ヘッダー -->
    <header class="header">
        <div class="header-content">
            <a href="index.html" class="back-button">
                <i class="fas fa-arrow-left"></i>
                ホームに戻る
            </a>
            <div class="header-title">
                <h1>🎮 ジブンクラフト</h1>
                <p>冒険者プロフィールをカスタマイズしよう！</p>
            </div>
            <div class="save-indicator" id="saveIndicator">
                <i class="fas fa-check-circle"></i>
                <span>保存済み</span>
            </div>
        </div>
    </header>

    <!-- メインコンテンツ -->
    <main class="main-container">
        <!-- キャラクタープレビュー -->
        <aside class="character-preview">
            <div class="preview-card">
                <div class="character-avatar">
                    <div class="avatar-circle" id="avatarCircle">
                        <input type="file" id="avatarInput" class="avatar-input" accept="image/*">
                        <img id="avatarImage" src="images/default-avatar.png" alt="プロフィール画像">
                        <div class="upload-icon">
                            <i class="fas fa-camera"></i>
                        </div>
                        <div class="upload-progress" id="uploadProgress"></div>
                    </div>
                    <div class="character-speech" id="characterSpeech">
                        <span id="speechText">よろしく！</span>
                    </div>
                </div>
                <h2 class="character-name" id="displayName">たろう</h2>
                
                <div class="character-stats">
                    <div class="stat-item">
                        <div class="stat-label">キャラ特性</div>
                        <div class="stat-value" id="displayCharacter">-</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">とくいスキル</div>
                        <div class="stat-value" id="displaySkill">-</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">すきな場所</div>
                        <div class="stat-value" id="displayPlace">-</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">仲間タイプ</div>
                        <div class="stat-value" id="displayCompanion">-</div>
                    </div>
                </div>
                
                <div class="completion-bar">
                    <div class="completion-fill" id="completionFill" style="width: 20%">
                        <div class="completion-text" id="completionText">20% 完成</div>
                    </div>
                </div>
            </div>
        </aside>

        <!-- 編集フォーム -->
        <section class="edit-form">
            <div class="form-tabs">
                <button class="tab-button active" data-tab="basic">
                    <i class="fas fa-user"></i> 基本情報
                </button>
                <button class="tab-button" data-tab="ability">
                    <i class="fas fa-star"></i> 能力設定
                </button>
                <button class="tab-button" data-tab="preference">
                    <i class="fas fa-heart"></i> 好み設定
                </button>
                <button class="tab-button" data-tab="social">
                    <i class="fas fa-users"></i> 仲間設定
                </button>
                <button class="tab-button" data-tab="message">
                    <i class="fas fa-comment"></i> メッセージ
                </button>
            </div>

            <!-- 基本情報タブ -->
            <div class="tab-content active" id="basic-tab">
                <div class="form-group">
                    <label class="form-label">
                        <span class="label-icon">👤</span>
                        ニックネーム
                        <span class="help-tooltip">
                            <i class="fas fa-question"></i>
                            <span class="tooltip-content">冒険で呼ばれる名前だよ！</span>
                        </span>
                    </label>
                    <input type="text" class="form-input" id="nickname" placeholder="例：たろう" maxlength="10">
                    <div class="character-limit">
                        <span id="nicknameCount">0</span> / 10文字
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">
                        <span class="label-icon">✨</span>
                        キャラ（特性）
                        <span class="help-tooltip">
                            <i class="fas fa-question"></i>
                            <span class="tooltip-content">どんな冒険者タイプ？</span>
                        </span>
                    </label>
                    <div class="choice-buttons">
                        <button class="choice-button" data-character="勇者">⚔️ 勇者</button>
                        <button class="choice-button" data-character="魔法使い">🪄 魔法使い</button>
                        <button class="choice-button" data-character="探検家">🗺️ 探検家</button>
                        <button class="choice-button" data-character="発明家">🔧 発明家</button>
                        <button class="choice-button" data-character="芸術家">🎨 芸術家</button>
                        <button class="choice-button" data-character="学者">📚 学者</button>
                    </div>
                    <input type="text" class="form-input" id="character" placeholder="その他の特性を入力" style="margin-top: 10px;">
                </div>
            </div>

            <!-- 能力設定タブ -->
            <div class="tab-content" id="ability-tab">
                <div class="form-group">
                    <label class="form-label">
                        <span class="label-icon">💪</span>
                        とくい（スキル）
                        <span class="help-tooltip">
                            <i class="fas fa-question"></i>
                            <span class="tooltip-content">得意なことを3つまで！</span>
                        </span>
                    </label>
                    <div class="choice-buttons">
                        <button class="choice-button skill-button" data-skill="プログラミング">💻 プログラミング</button>
                        <button class="choice-button skill-button" data-skill="デザイン">🎨 デザイン</button>
                        <button class="choice-button skill-button" data-skill="スポーツ">⚽ スポーツ</button>
                        <button class="choice-button skill-button" data-skill="音楽">🎵 音楽</button>
                        <button class="choice-button skill-button" data-skill="料理">🍳 料理</button>
                        <button class="choice-button skill-button" data-skill="コミュニケーション">💬 コミュニケーション</button>
                    </div>
                    <input type="text" class="form-input" id="skills" placeholder="その他のスキルを入力（カンマ区切り）" style="margin-top: 10px;">
                </div>

                <div class="form-group">
                    <label class="form-label">
                        <span class="label-icon">😅</span>
                        よわみ（苦手）
                        <span class="help-tooltip">
                            <i class="fas fa-question"></i>
                            <span class="tooltip-content">苦手なことも個性だよ！</span>
                        </span>
                    </label>
                    <textarea class="form-textarea" id="weakness" placeholder="例：朝起きるのが苦手、片付けが続かない" maxlength="50"></textarea>
                    <div class="character-limit">
                        <span id="weaknessCount">0</span> / 50文字
                    </div>
                </div>
            </div>

            <!-- 好み設定タブ -->
            <div class="tab-content" id="preference-tab">
                <div class="form-group">
                    <label class="form-label">
                        <span class="label-icon">🏖️</span>
                        すきな時間・場所
                        <span class="help-tooltip">
                            <i class="fas fa-question"></i>
                            <span class="tooltip-content">落ち着く場所や時間帯！</span>
                        </span>
                    </label>
                    <div class="choice-buttons">
                        <button class="choice-button place-button" data-place="カフェ">☕ カフェ</button>
                        <button class="choice-button place-button" data-place="図書館">📚 図書館</button>
                        <button class="choice-button place-button" data-place="公園">🌳 公園</button>
                        <button class="choice-button place-button" data-place="家">🏠 家</button>
                        <button class="choice-button place-button" data-place="夜の時間">🌙 夜の時間</button>
                        <button class="choice-button place-button" data-place="朝の時間">🌅 朝の時間</button>
                    </div>
                    <input type="text" class="form-input" id="favoritePlace" placeholder="その他の場所・時間を入力" style="margin-top: 10px;">
                </div>

                <div class="form-group">
                    <label class="form-label">
                        <span class="label-icon">⚡</span>
                        エネルギーチャージ方法
                        <span class="help-tooltip">
                            <i class="fas fa-question"></i>
                            <span class="tooltip-content">元気になる方法！</span>
                        </span>
                    </label>
                    <textarea class="form-textarea" id="energyCharge" placeholder="例：好きな音楽を聴く、散歩する、友達と話す" maxlength="100"></textarea>
                    <div class="character-limit">
                        <span id="energyChargeCount">0</span> / 100文字
                    </div>
                </div>
            </div>

            <!-- 仲間設定タブ -->
            <div class="tab-content" id="social-tab">
                <div class="form-group">
                    <label class="form-label">
                        <span class="label-icon">🤝</span>
                        一緒に冒険したい人
                        <span class="help-tooltip">
                            <i class="fas fa-question"></i>
                            <span class="tooltip-content">どんな仲間と冒険したい？</span>
                        </span>
                    </label>
                    <div class="choice-buttons">
                        <button class="choice-button companion-button" data-companion="リーダータイプ">👑 リーダータイプ</button>
                        <button class="choice-button companion-button" data-companion="サポータータイプ">🛡️ サポータータイプ</button>
                        <button class="choice-button companion-button" data-companion="ムードメーカー">🎭 ムードメーカー</button>
                        <button class="choice-button companion-button" data-companion="アイデアマン">💡 アイデアマン</button>
                        <button class="choice-button companion-button" data-companion="冷静な分析家">🧐 冷静な分析家</button>
                        <button class="choice-button companion-button" data-companion="行動派">🏃 行動派</button>
                    </div>
                    <input type="text" class="form-input" id="companion" placeholder="その他のタイプを入力" style="margin-top: 10px;">
                </div>
            </div>

            <!-- メッセージタブ -->
            <div class="tab-content" id="message-tab">
                <div class="form-group">
                    <label class="form-label">
                        <span class="label-icon">💭</span>
                        セリフ
                        <span class="help-tooltip">
                            <i class="fas fa-question"></i>
                            <span class="tooltip-content">キャラクターの口ぐせ！</span>
                        </span>
                    </label>
                    <input type="text" class="form-input" id="catchphrase" placeholder="例：よろしく！一緒に頑張ろう！" maxlength="30">
                    <div class="character-limit">
                        <span id="catchphraseCount">0</span> / 30文字
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">
                        <span class="label-icon">📝</span>
                        ひとこと
                        <span class="help-tooltip">
                            <i class="fas fa-question"></i>
                            <span class="tooltip-content">自己紹介メッセージ！</span>
                        </span>
                    </label>
                    <textarea class="form-textarea" id="message" placeholder="例：プログラミングが大好きな冒険者です！みんなで楽しく学びながら成長したいです。" maxlength="200"></textarea>
                    <div class="character-limit">
                        <span id="messageCount">0</span> / 200文字
                    </div>
                </div>
            </div>

            <!-- アクションボタン -->
            <div class="action-buttons">
                <button class="btn btn-secondary" onclick="cancelEdit()">
                    <i class="fas fa-times"></i> キャンセル
                </button>
                <button class="btn btn-primary" onclick="saveProfile()">
                    <i class="fas fa-save"></i> 保存する
                </button>
            </div>
        </section>
    </main>

    <!-- 実績モーダル -->
    <div class="modal-overlay" id="modalOverlay"></div>
    <div class="achievement-modal" id="achievementModal">
        <div class="achievement-icon">🏆</div>
        <h3 class="achievement-title">プロフィール完成！</h3>
        <p class="achievement-description">素晴らしい冒険者プロフィールができました！</p>
    </div>

    <!-- スクリプト -->
    <script src="js/include.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/profile.js"></script>
</body>
</html>